# Changelog

## 2025-02-02

<svg width="242.3438296781516" height="140.41232135250783" viewBox="0 0 242.3438296781516 140.41232135250783" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M152.89037255154045,79.04465996877987 C158.11937255154047,86.18215996877986 159.88637255154046,92.50665996877986 158.19037255154043,98.01865996877986 C156.77637255154045,103.53065996877986 151.90137255154045,108.37115996877988 143.56237255154045,112.54065996877985 C135.78937255154045,116.42715996877986 126.46037255154044,118.90065996877986 115.57837255154044,119.96065996877986 C104.83737255154045,120.95015996877986 93.53037255154044,120.31365996877987 81.65837255154047,118.05265996877988 C69.78637255154045,115.79165996877988 58.33837255154046,111.90465996877988 47.31437255154046,106.39265996877988 C36.57307255154046,101.02200996877987 29.011372551540433,95.40415996877987 24.63037255154046,89.53865996877987 C20.249372551540432,83.67315996877987 18.976672551540474,78.09080996877987 20.81437255154046,72.79065996877986 C22.934372551540434,67.49065996877987 27.810372551540468,62.93265996877987 35.44237255154047,59.11665996877987 C51.55437255154047,51.06065996877987 72.54207255154046,49.54150996877986 98.40637255154046,54.55865996877988 C92.32907255154046,43.46400996877986 96.49837255154046,34.31265996877987 110.91437255154045,27.10465996877987 C118.54637255154046,23.288659968779868 127.30907255154045,21.027309968779875 137.20237255154046,20.32065996877988 C147.23707255154045,19.543309968779866 157.41307255154044,20.17930996877986 167.73037255154046,22.228659968779866 C178.18897255154045,24.34865996877987 187.94107255154046,27.670009968779866 196.98637255154046,32.192659968779864 C210.83737255154045,39.118159968779864 219.03467255154044,46.46750996877988 221.57837255154044,54.240659968779866 C224.26407255154044,62.08480996877988 219.88237255154044,68.86865996877987 208.43437255154043,74.59265996877987 C195.14937255154047,81.23515996877985 176.63437255154045,82.71965996877988 152.89037255154045,79.04465996877987 Z M176.63437255154045,42.58065996877987 C170.69837255154044,39.61265996877988 164.47967255154046,38.05800996877987 157.97837255154045,37.91665996877987 C151.61837255154046,37.704659968779865 145.54137255154046,39.047159968779866 139.74637255154045,41.944659968779874 C134.51737255154046,44.559159968779866 131.83207255154045,47.45650996877987 131.69037255154046,50.63665996877987 C131.69067255154044,53.74580996877988 133.73937255154044,57.668159968779875 137.8383725515405,62.40265996877987 L140.59437255154046,65.26465996877987 C148.93337255154046,66.18315996877988 155.92937255154047,66.28915996877987 161.58237255154046,65.58265996877986 C167.37737255154047,64.80515996877988 172.74737255154048,63.180159968779876 177.69437255154045,60.706659968779874 C183.06537255154046,58.02115996877987 185.68007255154046,55.08880996877987 185.53837255154045,51.90865996877987 C185.53807255154044,48.65780996877986 182.57037255154046,45.54865996877987 176.63437255154045,42.58065996877987 Z M70.21037255154046,95.79265996877986 C77.55937255154046,99.46715996877988 85.05037255154045,101.37565996877989 92.68237255154047,101.51665996877988 C100.45637255154044,101.72865996877987 107.38137255154045,100.31515996877987 113.45837255154045,97.27665996877987 C119.53537255154045,94.23815996877987 122.57437255154046,90.95165996877988 122.57437255154045,87.41865996877989 C122.57437255154046,83.88565996877988 119.67637255154045,79.04465996877987 113.88237255154046,72.89665996877987 L109.43037255154046,68.33865996877988 C93.31837255154045,65.79465996877987 79.18537255154045,67.56115996877988 67.03037255154045,73.63865996877986 C60.67037255154047,76.81865996877987 57.77337255154045,80.38715996877987 58.33837255154046,84.34465996877988 C58.90337255154046,88.30215996877986 62.86107255154046,92.11800996877987 70.21037255154046,95.79265996877986 Z" fill="#4B0FFE"/><g data-index="1" data-x="158.81332092017317" data-y="93.79463566111346"><circle cx="158.81332092017317" cy="93.79463566111346" r="6" fill="red" stroke="white" stroke-width="1"/><text x="158.81332092017317" y="93.79463566111346" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">1</text></g><g data-index="2" data-x="20.062798588975063" data-y="76.22234457002286"><circle cx="20.062798588975063" cy="76.22234457002286" r="6" fill="red" stroke="white" stroke-width="1"/><text x="20.062798588975063" y="76.22234457002286" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">2</text></g><g data-index="3" data-x="97.41732571822676" data-y="52.569614151392095"><circle cx="97.41732571822676" cy="52.569614151392095" r="6" fill="red" stroke="white" stroke-width="1"/><text x="97.41732571822676" y="52.569614151392095" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">3</text></g><g data-index="4" data-x="95.74866919148259" data-y="46.358965871899834"><circle cx="95.74866919148259" cy="46.358965871899834" r="6" fill="red" stroke="white" stroke-width="1"/><text x="95.74866919148259" y="46.358965871899834" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">4</text></g><g data-index="5" data-x="222.2501462133157" data-y="57.09921731220663"><circle cx="222.2501462133157" cy="57.09921731220663" r="6" fill="red" stroke="white" stroke-width="1"/><text x="222.2501462133157" y="57.09921731220663" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">5</text></g><g data-index="6" data-x="131.78283676567838" data-y="51.81676281346756"><circle cx="131.78283676567838" cy="51.81676281346756" r="6" fill="red" stroke="white" stroke-width="1"/><text x="131.78283676567838" y="51.81676281346756" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">6</text></g><g data-index="7" data-x="185.41485150074303" data-y="50.76626376577067"><circle cx="185.41485150074303" cy="50.76626376577067" r="6" fill="red" stroke="white" stroke-width="1"/><text x="185.41485150074303" y="50.76626376577067" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">7</text></g><g data-index="8" data-x="89.25707348903751" data-y="98.47591995174128"><circle cx="89.25707348903751" cy="98.47591995174128" r="6" fill="red" stroke="white" stroke-width="1"/><text x="89.25707348903751" y="98.47591995174128" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">8</text></g><g data-index="9" data-x="122.5739868578579" data-y="87.34789044430944"><circle cx="122.5739868578579" cy="87.34789044430944" r="6" fill="red" stroke="white" stroke-width="1"/><text x="122.5739868578579" y="87.34789044430944" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">9</text></g><g data-index="10" data-x="58.26921904225829" data-y="83.38894970458837"><circle cx="58.26921904225829" cy="83.38894970458837" r="6" fill="red" stroke="white" stroke-width="1"/><text x="58.26921904225829" y="83.38894970458837" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">10</text></g><g data-index="11" data-x="155.95929905978142" data-y="79.8890630830973"><circle cx="155.95929905978142" cy="79.8890630830973" r="6" fill="red" stroke="white" stroke-width="1"/><text x="155.95929905978142" y="79.8890630830973" font-size="6" fill="white" text-anchor="middle" dominant-baseline="middle">11</text></g><path d="M158.81332092017317,93.79463566111346 L20.062798588975063,76.22234457002286 L20.062798588975063,56.222344570022855 L158.81332092017317,73.79463566111346 Z" fill="gray" opacity="0.5"/><path d="M20.062798588975063,76.22234457002286 L97.41732571822676,52.569614151392095 L97.41732571822676,32.569614151392095 L20.062798588975063,56.222344570022855 Z" fill="gray" opacity="0.5"/><path d="M97.41732571822676,52.569614151392095 L95.74866919148259,46.358965871899834 L95.74866919148259,26.358965871899834 L97.41732571822676,32.569614151392095 Z" fill="gray" opacity="0.5"/><path d="M95.74866919148259,46.358965871899834 L222.2501462133157,57.09921731220663 L222.2501462133157,37.09921731220663 L95.74866919148259,26.358965871899834 Z" fill="gray" opacity="0.5"/><path d="M222.2501462133157,57.09921731220663 L131.78283676567838,51.81676281346756 L131.78283676567838,31.816762813467562 L222.2501462133157,37.09921731220663 Z" fill="gray" opacity="0.5"/><path d="M131.78283676567838,51.81676281346756 L185.41485150074303,50.76626376577067 L185.41485150074303,30.766263765770667 L131.78283676567838,31.816762813467562 Z" fill="gray" opacity="0.5"/><path d="M185.41485150074303,50.76626376577067 L89.25707348903751,98.47591995174128 L89.25707348903751,78.47591995174128 L185.41485150074303,30.766263765770667 Z" fill="gray" opacity="0.5"/><path d="M89.25707348903751,98.47591995174128 L122.5739868578579,87.34789044430944 L122.5739868578579,67.34789044430944 L89.25707348903751,78.47591995174128 Z" fill="gray" opacity="0.5"/><path d="M122.5739868578579,87.34789044430944 L58.26921904225829,83.38894970458837 L58.26921904225829,63.38894970458837 L122.5739868578579,67.34789044430944 Z" fill="gray" opacity="0.5"/><path d="M58.26921904225829,83.38894970458837 L155.95929905978142,79.8890630830973 L155.95929905978142,59.8890630830973 L58.26921904225829,63.38894970458837 Z" fill="gray" opacity="0.5"/></svg>

Trying to build the walls of the 3D shapes is proving to be vanishingly elusive.

First some good news...

- It is now possible to recenter the shapes withing a new view, which is nice for seeing the whole output.
- I have a strategy in place for visualizing the wall boundaries for better visual degugging.
- Starter walls are being constructed, visualized in grey and with a preset height.

Let's talk about some challenges.

### Wall Boundaries

Finding all the wall boundaries is proving even more difficult that I had imagined. In general, each wall boundary should be either a sharp corner, or a local horizontal extrema point. Those local extrema form the visible left-most and right-most points of walls in the isometric projection.

One challenge is ensuring that duplicates don't appear when an extrema point and a sharp turn are the same boundary. The extra points are being found by sampling along the path, so the points may not match perfectly with and found corners.

It's also proving difficult to put the wall boundaries in order. This is important to do, because we should construct walls between each pair of points, and the walls should following along the edge of the shape, and not cut through it.

Finally, when a path includes a hole in the middle, there should be a separation, with no wall connecting from the outside of the path to the inner walls for the hole.

All of this is getting tantalizingly close to working, but it isn't quite there yet.

### Wall Shapes

Right now, I'm producing wall shapes between two wall boundaries using a simple quadrilateral shape, which produces straight walls. In order to support curved shapes, the wall segments should use a segment of the path from the floor shape to determine the top and bottom of the wall path.

I've started to use the [Paper.js](http://paperjs.org) library to help with certain calculations, including for bounding boxes. It should also help to isolate the subpaths for the tops and bottoms of wall shapes. I'd prefer to reduce the dependcies of this project, so I will probably take the approach of using libraries like this for now while getting everything working, and treat dependency reduction as a goal for later.

### Just Keep Swimming

Despite these challenges, progress continues. Floors (and ceilings) are in good shape, and I'm impressed by the variety of shapes which the pipeline can process into an isometric space now. Once the challenges with constructing the walls are cracked, I can focus on producing final shapes and start introducing concepts for different heights and elevations for the extruded shapes, which should be fun.

Stay tuned.

## 2025-01-27

<svg width="143" height="126" viewBox="0 0 143 126" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M24,36 L71,59.5 C84.254833995944,66.127416997972 84.254833995944,76.872583002028 71,83.5 L41,98.5 C27.745166004056003,105.127416997972 6.254833995943997,105.127416997972 -7,98.5 L-54,75 C-67.254833995944,68.372583002028 -67.254833995944,57.627416997972 -54,51 L-24,36 C-10.745166004056003,29.372583002028 10.745166004056003,29.372583002028 24,36 Z" fill="#D50C34"/>
  <path d="M24,16 L71,39.5 C84.254833995944,46.127416997972006 84.254833995944,56.872583002027994 71,63.5 L41,78.5 C27.745166004056003,85.127416997972 6.254833995943997,85.127416997972 -7,78.5 L-54,55 C-67.254833995944,48.372583002027994 -67.254833995944,37.627416997972 -54,31 L-24,16 C-10.745166004056003,9.372583002028001 10.745166004056003,9.372583002028001 24,16 Z" fill="#D50C34"/>
  <path d="M20.200000000000003,75.53999999999999 L12.608000000000004,79.336 L8.968000000000004,77.51599999999999 L2,81 L-8.087999999999994,75.956 L-1.171999999999997,72.446 L-15.991999999999997,65.036 L-9.283999999999999,61.682 L23.215999999999994,55.156 L28.884000000000007,61.11 L2.156000000000006,66.518 L6.524000000000001,68.702 L15.415999999999997,65.452 L24.256,69.872 L16.560000000000002,73.72 L20.200000000000003,75.53999999999999 Z" fill="white"/>
  <path d="M20.200000000000003,55.53999999999999 L12.608000000000004,59.336 L8.968000000000004,57.51599999999999 L2,61 L-8.087999999999994,55.956 L-1.171999999999997,52.446 L-15.991999999999997,45.036 L-9.283999999999999,41.682 L23.215999999999994,35.156 L28.884000000000007,41.11 L2.156000000000006,46.518 L6.524000000000001,48.702 L15.415999999999997,45.452 L24.256,49.872 L16.560000000000002,53.72 L20.200000000000003,55.53999999999999 Z" fill="white"/>
</svg>

After much head-banging and code-wrangling, I've started on a new approach to make things more systematic as this progresses. I'm now using a pipeline process to transform the original SVG in stages, which also allows me to visualize the output and debug at each step.

### Pipeline

The transform process is not broken down into steps, with the following working at the moment:

1. Split into Shapes
2. Convert Shapes to Paths
3. Construct Floor and Ceiling
4. Transform to Isometric

This approach has already borne significant fruit.

### Paths and Curves

For example, the isometric transformation was struggling to handle arcs correctly. So instead, when shapes are converted into paths, now rounded corners, circles, and ellipses are converted into approximated BÃ©zier curves. This approach, in combination with the switch to converting everything to paths, has made the projected isometric output smoother and more predictable.

As a bonus, this means that a wider variety of shapes can now be used.

### Glass Walls

At this stage, the new pipeline doesn't yet add walls, so let's just pretend they are transparent for now.

It's anyone's guess how the roofs are supported.

### Further Reading

While casting about trying to understand what was going on, I came across Peter Collingridge's tutorial on [Isometric Projection](https://www.petercollingridge.co.uk/tutorials/svg/isometric-projection/). While I'm not currently using this approach, it was illuminating nonetheless. (Content warning: mathematics.)

## 2025-01-25

<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 134.875 122.325">
  <polygon points="40,10 10,25 10,45 40,30" fill="#cc8400"></polygon>
  <polygon points="10,25 60,50 60,70 10,45" fill="#e59400"></polygon>
  <polygon points="90,35 60,50 60,70 90,55" fill="#cc8400"></polygon>
  <defs>
    <linearGradient id="gradient-100-50" gradientUnits="userSpaceOnUse" x1="55.125" y1="95" x2="124.875" y2="95">
      <stop offset="0%" style="stop-color:#730073;stop-opacity:1"></stop>
      <stop offset="100%" style="stop-color:#660066;stop-opacity:1"></stop>
    </linearGradient>
  </defs>
  <path d="M55.125,75
  A34.875,17.325 0 0,0 124.875,75
  L124.875,95
  A34.875,17.325 0 0,1 55.125,95
  Z" fill="url(#gradient-100-50)"></path>
  <polygon points="40,10 90,35 60,50 10,25" fill="orange"></polygon>
  <ellipse cx="90" cy="75" rx="34.875" ry="17.325" fill="purple"></ellipse>
</svg>

The initial version of the extruder is working with a very limited feature set.

The goal is to take a source "birds-eye" SVG file and extrude it into an isometric projection.

- Rectangular shapes are supported
- Circular shapes are supported
- Extrusions are all to the same height
- Fill color carries over
- Simple shading is applied to the sides of an extruded object

For development convenience, a set of test source SVGs are provided. Running `npm run dev` will open a demo page in your browser to see the input and output of these test SVGs. It will also watch for changes, regenerate the extruded SVGs, and refresh the browser. Add new test SVGs to `tests/sources` to include them in this process.
